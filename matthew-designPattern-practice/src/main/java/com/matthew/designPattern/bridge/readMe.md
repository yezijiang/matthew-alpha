## 处理多维度变化--桥接模式

#### 引申
欲开发一个跨平台图像浏览系统，要求该系统能够显示BMP、JPG、GIF、PNG等多种格式的文件，并且能够咋windows、linux、unix等到个操作系统上运行。一般的设计方案是使用多层继承结构，Image是抽象父类，每一种图片类型都有其直接子类，每个子类都三种子类标识在不同操作系统。此设计方案的主要问题：

- 由于采用了多层继承结构，导致系统中类的个数急剧增加。
- 系统扩展麻烦，每一个具体的类既包含文件格式信息，又包含操作系统信息。任何一个维度变化，都需要增加具体类。

这种设计方案也违背了“单一职责原则”，我们应该将图片文件格式（对应图像格式的解析）和操作系统（对应像素矩阵的显示）两个维度分离，是他们可以独立变化。

#### 概述
桥接模式（Bridge Pattern）:将抽象部分与他的实现部分分离，使它们都可以独立的发生变化。
![桥接模式结构图](file:///F:\yaoyaohao\workspaceIdea\matthew-alpha\matthew-designPattern-practice\src\main\webapp\webstatic\images\bridge_001.gif)
通常情况下，我们将具有两个独立变化维度的类的一些普通业务方法和与之关系最密切的维度设计为“抽象类”层次结构，而另一维度设计为“实现类”层次结构。
再具体编码时，由于桥接模式中存在两个独立变化的额度，为了使两者之间耦合度降低，首相需要针对两个不同的维度提取抽象类和实现类接口，并建立一个抽象的关系。
对于客户端而言，可以针对两个维度的抽象层编程，在程序运行时在动态确定两个维度的子类。

#### 完整解决方案
![跨平台图像浏览系统结构图](file:///F:\yaoyaohao\workspaceIdea\matthew-alpha\matthew-designPattern-practice\src\main\webapp\webstatic\images\bridge_002.gif)

图中Image充当抽象类，其子类JPGImage/PNGImage充当扩充抽象类，ImageImp充当实现类接口，其子类WIndowsImp、LinuxMp充当具体实现接口

##适配器和桥接模式的联用
在软件开发中，适配器模式通常可以和桥接模式联合使用。适配器可以解决两个已有接口不能兼容的问题。或者用于现有系统和第三方产品功能的集成。桥接模式和适配器模式用于设计的不同阶段，桥接模式用于系统的初步设计，对于存在两个独立变化维度的类可以将其分为抽象化和实现化两个角色，而再设计完成之后，发现系统和已有类无法协同工作时，可以采用适配器模式。有时在设计初期也需要考虑适配器模式，特别是那些涉及到大量第三方应用接口的情况。
![桥接模式与适配器模式联用示意图](file:///F:\yaoyaohao\workspaceIdea\matthew-alpha\matthew-designPattern-practice\src\main\webapp\webstatic\images\bridge_003.gif)

总结：
桥接模式是设计java virtual machine和实现JDBC等驱动程序的核心模式之一。
桥接模式的主要**优点**如下：

- 分析抽象接口和实现部分。通过使用组合而不是子类化，解耦了抽象和实现之间固有的绑定关系。
- 在很多情况下，桥接模式可以取代多层继承方案，多层继承方案违背了”单一职责原则“，复用性较差。
- 桥接模式提高了系统的可扩展性，在两个变化的维度中任意扩展一个维度，都不需要修改原系统，符合“开闭原则”。

**缺点：**

- 桥接模式会增加系统的理解和设计难度。
- 桥接模式要求能正确识别出系统中两个独立变化的维度，因此适用范围有一定而局限性，如何正确识别两个独立维度也需要一定的经验积累。

**适用场景：**

- 如何一个系统需要在具体化和抽象化之间增加更多的灵活性。
- 抽象部分和实现部分可以以继承方式独立扩展而互不影响，程序运行时系统需要对抽象角色和实现化角色进行动态耦合。
- 对于那些不希望使用继承或因为多层继承关系导致类的个数急剧增加的系统，桥接模式尤为合适。